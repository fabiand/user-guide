<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>KubeVirt Latest | Using Virtual Machines | Node placement</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

    <link href="../../latest/_stylesheets/asciibinder.css" rel="stylesheet" />

   <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
   <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
   <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
     <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
   <![endif]-->

  <link href="../../latest/_images/favicon32x32.png" rel="shortcut icon" type="text/css">
  <!--[if IE]><link rel="shortcut icon" href="../../latest/_images/favicon.ico"><![endif]-->
  <meta content="AsciiBinder" name="application-name">
</head>
<body>
  <div class="navbar navbar-default" role="navigation">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="http://www.asciibinder.org/"><img alt="AsciiBinder" height="64px" src="../../latest/_images/KubeVirt_icon.png"></a>
      </div>
    </div>
  </div>
  <div class="container">
    <p class="toggle-nav visible-xs pull-left">
      <button class="btn btn-default btn-sm" type="button" data-toggle="offcanvas">Toggle nav</button>
    </p>
    <ol class="breadcrumb">
      <li class="sitename">
        <a href="../../index.html">Documentation</a>
      </li>
      <li class="hidden-xs active">
        <a href="../welcome/index.html">KubeVirt Latest</a>
      </li>
      <li class="hidden-xs active">
        <a href="../using-virtual-machines/usage.html">Using Virtual Machines</a>
      </li>
      
      <li class="hidden-xs active">
        Node placement
      </li>
    </ol>
    <div class="row row-offcanvas row-offcanvas-left">
      <div class="col-xs-8 col-sm-3 col-md-3 sidebar sidebar-offcanvas">
        <ul class="nav nav-sidebar">
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup0">
        <span id="tgSpan0" class="fa fa-angle-right"></span>Welcome
      </a>
      <ul id="topicGroup0" class="collapse  list-unstyled">
            <li><a class="" href="../welcome/index.html">Welcome</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup1">
        <span id="tgSpan1" class="fa fa-angle-right"></span>Release Notes
      </a>
      <ul id="topicGroup1" class="collapse  list-unstyled">
            <li><a class="" href="../release-notes/changelog.html">Changelog</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup2">
        <span id="tgSpan2" class="fa fa-angle-right"></span>Architecture
      </a>
      <ul id="topicGroup2" class="collapse  list-unstyled">
            <li><a class="" href="../architecture/virtual-machine.html">Virtual Machines</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup3">
        <span id="tgSpan3" class="fa fa-angle-right"></span>Installation & Administration
      </a>
      <ul id="topicGroup3" class="collapse  list-unstyled">
            <li><a class="" href="../administration/intro.html">Installation</a></li>
            <li><a class="" href="../administration/api-validation.html">Webhooks</a></li>
            <li><a class="" href="../administration/authorization.html">Authorization</a></li>
            <li><a class="" href="../administration/monitoring.html">Monitoring</a></li>
            <li><a class="" href="../administration/annotations_and_labels.html">Annotations and Labels</a></li>
            <li><a class="" href="../administration/unresponsive-nodes.html">Unresponsive node handling</a></li>
            <li><a class="" href="../administration/node-eviction.html">Node eviciton</a></li>
            <li><a class="" href="../administration/image-upload.html">Image upload</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup4">
        <span id="tgSpan4" class="fa fa-angle-right"></span>Creating Virtual Machines
      </a>
      <ul id="topicGroup4" class="collapse  list-unstyled">
            <li><a class="" href="../creating-virtual-machines/intro.html">Introduction</a></li>
            <li><a class="" href="../creating-virtual-machines/virtualized-hardware-configuration.html">Devices</a></li>
            <li><a class="" href="../creating-virtual-machines/disks-and-volumes.html">Disks and Volumes</a></li>
            <li><a class="" href="../creating-virtual-machines/interfaces-and-networks.html">Interfaces and Networks</a></li>
            <li><a class="" href="../creating-virtual-machines/dedicated-cpu.html">Guaranteed CPU usage</a></li>
            <li><a class="" href="../creating-virtual-machines/startup-scripts.html">cloud-init</a></li>
            <li><a class="" href="../creating-virtual-machines/guest-operating-system-information.html">Associating Guest Informations</a></li>
            <li><a class="" href="../creating-virtual-machines/presets.html">Presets</a></li>
            <li><a class="" href="../creating-virtual-machines/probes.html">Probes</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup5">
        <span id="tgSpan5" class="fa fa-angle-down"></span>Using Virtual Machines
      </a>
      <ul id="topicGroup5" class="collapse in list-unstyled">
            <li><a class="" href="../using-virtual-machines/usage.html">Usage</a></li>
            <li><a class="" href="../using-virtual-machines/life-cycle.html">Starting and Stopping</a></li>
            <li><a class="" href="../using-virtual-machines/graphical-and-console-access.html">Console Access (Serial and Graphical)</a></li>
            <li><a class=" active" href="../using-virtual-machines/assigning-vms-to-nodes.html">Node placement</a></li>
            <li><a class="" href="../using-virtual-machines/dns.html">DNS Integration</a></li>
            <li><a class="" href="../using-virtual-machines/expose-service.html">Service Integration</a></li>
            <li><a class="" href="../using-virtual-machines/create-networkpolicy.html">Assigning Network Policies</a></li>
            <li><a class="" href="../using-virtual-machines/overcommit.html">Memory over-commit</a></li>
            <li><a class="" href="../using-virtual-machines/virtual-machine-replica-set.html">Virtual Machine Replica Set</a></li>
            <li><a class="" href="../using-virtual-machines/vmctl.html">vmctl</a></li>
      </ul>
    </li>
    <li class="nav-header">
      <a class="" href="#" data-toggle="collapse" data-target="#topicGroup6">
        <span id="tgSpan6" class="fa fa-angle-right"></span>Working with Templates
      </a>
      <ul id="topicGroup6" class="collapse  list-unstyled">
            <li><a class="" href="../templates/common-templates.html">Introduction</a></li>
            <li><a class="" href="../templates/using-templates.html">Using templates</a></li>
      </ul>
    </li>
</ul>
      </div>
      <div class="col-xs-12 col-sm-9 col-md-9 main">
        <div class="page-header">
          <h2>Assigning VMs to Nodes</h2>
        </div>
        <div class="sect1">
<h2 id="assigning-vms-to-nodes"><a class="anchor" href="#assigning-vms-to-nodes"></a>Assigning VMs to Nodes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can constrain the VM to only run on specific nodes or to prefer
running on specific nodes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>nodeSelector</strong></p>
</li>
<li>
<p><strong>Affinity and anti-affinity</strong></p>
</li>
<li>
<p><strong>Taints and Tolerations</strong></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="nodeselector"><a class="anchor" href="#nodeselector"></a>nodeSelector</h3>
<div class="paragraph">
<p>Setting <code>spec.nodeSelector</code> requirements, constrains the scheduler to
only schedule VMs on nodes, which contain the specified labels. In the
following example the vmi contains the labels <code>cpu: slow</code> and
<code>storage: fast</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">metadata</span>:
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">testvmi-ephemeral</span></span>
<span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha2</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">nodeSelector</span>:
    <span style="color:#606">cpu</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">slow</span></span>
    <span style="color:#606">storage</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">fast</span></span>
  <span style="color:#606">domain</span>:
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvcdisk</span></span>
        <span style="color:#606">volumeName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mypvc</span></span>
        <span style="color:#606">lun</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{}</span></span>
  <span style="color:#606">volumes</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvc</span></span>
      <span style="color:#606">persistentVolumeClaim</span>:
        <span style="color:#606">claimName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mypvc</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Thus the scheduler will only schedule the vmi to nodes which contain
these labels in their metadata. It works exactly like the Pods
<code>nodeSelector</code>. See the
<a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#nodeselector">Pod
nodeSelector Documentation</a> for more examples.</p>
</div>
</div>
<div class="sect2">
<h3 id="affinity-and-anti-affinity"><a class="anchor" href="#affinity-and-anti-affinity"></a>Affinity and anti-affinity</h3>
<div class="paragraph">
<p>The <code>spec.affinity</code> field allows specifying hard- and soft-affinity for
VMs. It is possible to write matching rules agains workloads (VMs and
Pods) and Nodes. Since VMs are a workload type based on Pods,
Pod-affinity affects VMs as well.</p>
</div>
<div class="paragraph">
<p>An example for <code>podAffinity</code> and <code>podAntiAffinity</code> may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">metadata</span>:
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">testvmi-ephemeral</span></span>
<span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha2</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">nodeSelector</span>:
    <span style="color:#606">cpu</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">slow</span></span>
    <span style="color:#606">storage</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">fast</span></span>
  <span style="color:#606">domain</span>:
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvcdisk</span></span>
        <span style="color:#606">volumeName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mypvc</span></span>
        <span style="color:#606">lun</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{}</span></span>
  <span style="color:#606">affinity</span>:
    <span style="color:#606">podAffinity</span>:
      <span style="color:#606">requiredDuringSchedulingIgnoredDuringExecution</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">labelSelector:</span><span style="color:#D20">
          matchExpressions:
          - key: security
            operator: In
            values:
            - S1</span></span>
        <span style="color:#606">topologyKey</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">failure-domain.beta.kubernetes.io/zone</span></span>
    <span style="color:#606">podAntiAffinity</span>:
      <span style="color:#606">preferredDuringSchedulingIgnoredDuringExecution</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">weight: 100</span></span>
        <span style="color:#606">podAffinityTerm</span>:
          <span style="color:#606">labelSelector</span>:
            <span style="color:#606">matchExpressions</span>:
            - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">key: security</span></span>
              <span style="color:#606">operator</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">In</span></span>
              <span style="color:#606">values</span>:
              - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">S2</span></span>
          <span style="color:#606">topologyKey</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubernetes.io/hostname</span></span>
  <span style="color:#606">volumes</span>:
    - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvc</span></span>
      <span style="color:#606">persistentVolumeClaim</span>:
        <span style="color:#606">claimName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mypvc</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Affinity and anti-affinity works exactly like the Pods <code>affinity</code>. This
includes <code>podAffinity</code>, <code>podAntiAffinity</code>, <code>nodeAffinity</code> and
<code>nodeAntiAffinity</code>. See the
<a href="https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity">Pod
affinity and anti-affinity Documentation</a> for more examples and details.</p>
</div>
</div>
<div class="sect2">
<h3 id="taints-and-tolerations"><a class="anchor" href="#taints-and-tolerations"></a>Taints and Tolerations</h3>
<div class="paragraph">
<p>Affinity as described above, is a property of VMs that attracts them to
a set of nodes (either as a preference or a hard requirement). Taints
are the opposite – they allow a node to repel a set of VMs.</p>
</div>
<div class="paragraph">
<p>Taints and tolerations work together to ensure that VMs are not
scheduled onto inappropriate nodes. One or more taints are applied to a
node; this marks that the node should not accept any VMs that do not
tolerate the taints. Tolerations are applied to VMs, and allow (but do
not require) the VMs to schedule onto nodes with matching taints.</p>
</div>
<div class="paragraph">
<p>You add a taint to a node using kubectl taint. For example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">kubectl taint nodes node1 key=value:NoSchedule</code></pre>
</div>
</div>
<div class="paragraph">
<p>An example for <code>tolerations</code> may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span style="color:#606">metadata</span>:
  <span style="color:#606">name</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">testvmi-ephemeral</span></span>
<span style="color:#606">apiVersion</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">kubevirt.io/v1alpha2</span></span>
<span style="color:#606">kind</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">VirtualMachineInstance</span></span>
<span style="color:#606">spec</span>:
  <span style="color:#606">nodeSelector</span>:
    <span style="color:#606">cpu</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">slow</span></span>
    <span style="color:#606">storage</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">fast</span></span>
  <span style="color:#606">domain</span>:
    <span style="color:#606">resources</span>:
      <span style="color:#606">requests</span>:
        <span style="color:#606">memory</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">64M</span></span>
    <span style="color:#606">devices</span>:
      <span style="color:#606">disks</span>:
      - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">name: mypvcdisk</span></span>
        <span style="color:#606">volumeName</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">mypvc</span></span>
        <span style="color:#606">lun</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">{}</span></span>
  <span style="color:#606">tolerations</span>:
  - <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#D20">key: &quot;key&quot;</span></span>
    <span style="color:#606">operator</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Equal</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">value</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">value</span><span style="color:#710">&quot;</span></span>
    <span style="color:#606">effect</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">NoSchedule</span><span style="color:#710">&quot;</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
      </div>
    </div>
  </div>
   <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
   <!-- Latest compiled and minified JavaScript -->
   <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
   <script src="../../latest/_javascripts/bootstrap-offcanvas.js" type="text/javascript"></script>
   <script type="text/javascript">
    /*<![CDATA[*/
    $(document).ready(function() {
      $("[id^='topicGroup']").on('show.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicGroup']").on('hide.bs.collapse', function (event) {
        if (!($(event.target).attr('id').match(/^topicSubGroup/))) {
          $(this).parent().find("[id^='tgSpan']").toggleClass("fa-angle-right fa-angle-down");
        }
      });
      $("[id^='topicSubGroup']").on('show.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
      $("[id^='topicSubGroup']").on('hide.bs.collapse', function () {
        $(this).parent().find("[id^='sgSpan']").toggleClass("fa-caret-right fa-caret-down");
      });
    });
    /*]]>*/
  </script>
</body>
</html>